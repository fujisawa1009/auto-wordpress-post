# 自動WordPress記事投稿システム 開発計画書

**プロジェクト名**: Auto WordPress Post Generator
**バージョン**: 1.0
**作成日**: 2025-09-22
**開発期間**: 4-6週間（想定）

## 1. 開発概要

### 1.1 プロジェクト目標
- ユーザー入力の要約から約10,000字の記事を自動生成
- Perplexity APIを使用した段階的記事生成
- WordPress REST APIによる自動投稿機能
- プレビュー機能付きの安全な記事管理

### 1.2 開発方針
- **アジャイル開発**: 2週間スプリント × 2-3回
- **MVP優先**: 最小機能から段階的拡張
- **品質重視**: テスト駆動開発（TDD）
- **Docker化**: 環境統一とデプロイ効率化

## 2. 開発フェーズ

### Phase 1: 基盤構築（Week 1-2）
**目標**: 基本的なアーキテクチャとデータフローの構築

#### 2.1 環境セットアップ
- [ ] Docker/Docker Compose環境構築
- [ ] PostgreSQL/Redis コンテナ設定
- [ ] 開発環境の統一（.env, pyproject.toml）
- [ ] Git リポジトリ初期化、ブランチ戦略決定

#### 2.2 基盤コンポーネント
- [ ] FastAPI アプリケーション基盤
- [ ] SQLAlchemy モデル定義（articles, jobs, taxonomies）
- [ ] Alembic マイグレーション設定
- [ ] Pydantic スキーマ定義（入出力）
- [ ] Celery/Redis ワーカー基盤

#### 2.3 外部API クライアント
- [ ] Perplexity API クライアント実装
- [ ] WordPress REST API クライアント実装
- [ ] エラーハンドリング・リトライ機構

**成果物**:
- 基本的なAPIエンドポイント
- データベース接続確認
- 外部API接続テスト

### Phase 2: 記事生成エンジン（Week 2-3）
**目標**: Perplexity APIを使用した記事生成機能の実装

#### 2.4 記事生成ロジック
- [ ] 章立て生成アルゴリズム（H2×6-9, H3×2-3）
- [ ] 章ごと本文生成処理
- [ ] 記事結合・校正ロジック
- [ ] HTML整形・サニタイズ機能
- [ ] 文字数調整アルゴリズム（9,000-11,000字）

#### 2.5 非同期処理
- [ ] Celery タスク実装（generate, publish）
- [ ] ジョブステータス管理
- [ ] 冪等性実装（入力ハッシュ）
- [ ] エラー処理・リトライ機構

#### 2.6 プロンプトエンジニアリング
- [ ] 章立て生成プロンプト
- [ ] 本文生成プロンプト
- [ ] JSON最終化プロンプト
- [ ] プロンプトテンプレート管理

**成果物**:
- 記事生成エンド・ツー・エンド
- 文字数制御機能
- 非同期ジョブ処理

### Phase 3: WordPress連携（Week 3-4）
**目標**: WordPress投稿機能とプレビュー機能の実装

#### 2.7 WordPress 投稿機能
- [ ] カテゴリ/タグ解決機能
- [ ] 投稿作成API（下書き/公開/予約）
- [ ] メディア処理（hero_image_prompt対応）
- [ ] 認証処理（Application Password）

#### 2.8 プレビュー機能
- [ ] HTMLサニタイズ・表示
- [ ] プレビューテンプレート
- [ ] セキュアな記事閲覧
- [ ] 編集・再生成機能

#### 2.9 API エンドポイント
- [ ] POST /api/articles/generate
- [ ] GET /api/articles/{id}
- [ ] POST /api/articles/{id}/publish
- [ ] GET /api/taxonomies/sync

**成果物**:
- WordPress自動投稿機能
- プレビュー画面
- 完全なREST API

### Phase 4: 品質向上・運用準備（Week 4-5）
**目標**: テスト・セキュリティ・運用機能の実装

#### 2.10 テスト実装
- [ ] 単体テスト（pytest）
- [ ] 統合テスト（API, DB, 外部API）
- [ ] 文字数制御テスト
- [ ] 冪等性テスト
- [ ] WordPress投稿テスト

#### 2.11 セキュリティ・監査
- [ ] HTMLサニタイズ強化
- [ ] 認証・認可確認
- [ ] ログ出力最適化（PII除去）
- [ ] 秘密情報管理
- [ ] HTTPS設定確認

#### 2.12 運用機能
- [ ] 構造化ログ実装
- [ ] メトリクス収集（Perplexity呼び出し、投稿成功率）
- [ ] ヘルスチェックエンドポイント
- [ ] エラー監視・アラート

**成果物**:
- 包括的テストスイート
- セキュリティ監査レポート
- 運用ドキュメント

### Phase 5: 最適化・リリース準備（Week 5-6）
**目標**: パフォーマンス最適化とリリース準備

#### 2.13 パフォーマンス最適化
- [ ] データベースクエリ最適化
- [ ] Celery ワーカー調整
- [ ] API レスポンス時間改善
- [ ] メモリ使用量最適化

#### 2.14 ドキュメント・展開
- [ ] API仕様書（OpenAPI）
- [ ] 運用マニュアル
- [ ] トラブルシューティングガイド
- [ ] デプロイメント手順書

#### 2.15 受け入れテスト
- [ ] E2Eテスト実行
- [ ] ユーザー受け入れテスト
- [ ] 負荷テスト
- [ ] セキュリティペネトレーションテスト

**成果物**:
- 本番環境対応システム
- 完全なドキュメントセット
- リリース判定レポート

## 3. タスク詳細とスケジュール

### 3.1 スプリント1（Week 1-2）
| タスク | 担当 | 工数 | 依存関係 |
|--------|------|------|----------|
| Docker環境構築 | DevOps | 1日 | - |
| データベース設計・実装 | Backend | 2日 | Docker環境 |
| FastAPI基盤 | Backend | 2日 | - |
| Pydanticスキーマ | Backend | 1日 | - |
| 外部APIクライアント | Backend | 3日 | FastAPI基盤 |
| Celery基盤 | Backend | 2日 | Docker環境 |

### 3.2 スプリント2（Week 3-4）
| タスク | 担当 | 工数 | 依存関係 |
|--------|------|------|----------|
| 記事生成ロジック | Backend | 5日 | 外部APIクライアント |
| 非同期処理実装 | Backend | 3日 | Celery基盤 |
| 文字数制御 | Backend | 2日 | 記事生成ロジック |
| プロンプト最適化 | AI Engineer | 3日 | 記事生成ロジック |

### 3.3 スプリント3（Week 5-6）
| タスク | 担当 | 工数 | 依存関係 |
|--------|------|------|----------|
| WordPress連携 | Backend | 4日 | 記事生成完了 |
| プレビュー機能 | Frontend | 3日 | - |
| テスト実装 | QA | 5日 | 全機能 |
| セキュリティ強化 | Security | 2日 | 全機能 |

## 4. リスク分析と対策

### 4.1 技術リスク
| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| Perplexity API制限 | 高 | 中 | レート制限対応、代替API検討 |
| WordPress API変更 | 中 | 低 | バージョン固定、後方互換性確保 |
| 文字数制御精度 | 中 | 中 | アルゴリズム改善、手動調整機能 |
| パフォーマンス問題 | 中 | 中 | 非同期処理、キャッシュ活用 |

### 4.2 スケジュールリスク
| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 要件変更 | 高 | 中 | アジャイル対応、MVP優先 |
| 外部API依存遅延 | 中 | 低 | モック実装、並行開発 |
| テスト期間不足 | 中 | 中 | TDD採用、自動化推進 |

### 4.3 運用リスク
| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| セキュリティ脆弱性 | 高 | 低 | セキュリティレビュー、ペネトレーションテスト |
| APIコスト超過 | 中 | 中 | 使用量監視、アラート設定 |
| WordPress互換性 | 低 | 低 | 複数バージョンでのテスト |

## 5. 品質保証計画

### 5.1 テスト戦略
- **単体テスト**: カバレッジ90%以上
- **統合テスト**: 主要ワークフローの網羅
- **E2Eテスト**: ユーザーシナリオベース
- **パフォーマンステスト**: 負荷・レスポンス時間
- **セキュリティテスト**: 脆弱性スキャン、ペネトレーションテスト

### 5.2 コード品質
- **コードレビュー**: 全PR必須
- **静的解析**: flake8, mypy, bandit
- **依存関係管理**: poetry, セキュリティアップデート
- **ドキュメント**: docstring, API仕様書

## 6. デプロイメント計画

### 6.1 環境構成
- **開発環境**: ローカルDocker Compose
- **ステージング環境**: 本番同等構成
- **本番環境**: クラウド/オンプレミス

### 6.2 CI/CD パイプライン
- **ビルド**: Docker イメージ作成
- **テスト**: 自動テスト実行
- **デプロイ**: ステージング→本番
- **監視**: ヘルスチェック、メトリクス

## 7. 成功指標

### 7.1 機能指標
- [ ] 文字数制御精度: 95%以上が9,000-11,000字範囲
- [ ] 記事生成成功率: 98%以上
- [ ] WordPress投稿成功率: 99%以上
- [ ] API応答時間: 記事生成5分以内、投稿30秒以内

### 7.2 品質指標
- [ ] テストカバレッジ: 90%以上
- [ ] セキュリティ脆弱性: Critical/High 0件
- [ ] パフォーマンス: 同時実行10記事まで対応
- [ ] 可用性: 99.5%以上

## 8. 次期バージョン計画

### 8.1 拡張機能候補
- 画像自動生成・WordPress メディア登録
- 多言語対応（日本語→英語）
- 内部リンク自動サジェスト
- SEO品質スコア機能
- 記事テンプレート機能

### 8.2 技術改善
- GraphQL API対応
- マイクロサービス化
- Kubernetes対応
- AI モデルの自社化

---

**承認**: 開発計画書承認後、Phase 1から開発開始
**レビュー**: 各フェーズ完了時に進捗レビュー実施
**更新**: 週次で計画見直し、必要に応じて調整